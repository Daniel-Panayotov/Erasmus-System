<header class="page-header">
  <p>Browse {{ sectionName }}</p>
  <div class="button-add button" (click)="togglePopup(false, -1)">
    {{ isPopupVisible && !isPopupEdit ? "Close Form" : "Add Record" }}
  </div>
</header>
<main class="page-main">
  <div class="settings">
    <p>
      Showing {{ documents.length }}
      {{ documents.length == 1 ? "entry" : "entries" }}
    </p>
    <div class="search-setting">
      <form
        class="search-form"
        [formGroup]="searchFieldForm"
        (submit)="
          changePage(1, searchFieldForm.value.search == '' ? false : true)
        "
      >
        <div class="search-select">
          <!-- hidden -->
          <input type="text" formControlName="select" class="hidden-select" />

          <button
            #selectBtn
            type="button"
            class="select-btn"
            (click)="toggleSelectLi()"
          >
            {{ searchSelectName }}
          </button>

          @if (isSearchLiVisible) {
          <ul class="search-form-ul">
            @for (property of docProperty; track $index) {

            <li (click)="changeSelectValue(property[0], property[1].name)">
              {{ property[1].name }}
            </li>
            }
          </ul>
          }
        </div>
        <input
          type="text"
          class="search-form-input"
          placeholder="Enter value..."
          formControlName="search"
        />
        <button type="submit" class="button search-form-button">Search</button>
      </form>
    </div>
  </div>
  <table class="documents-table">
    <thead>
      @for (property of docProperty; track $index) {
      <th class="{{ property[1].class }}">
        {{ property[1].name }}
      </th>
      }
      <th class="action-th">Action</th>
    </thead>
    <tbody class="documents-table-body">
      <tr *ngFor="let document of documents; let i = index">
        @for (property of docProperty; track $index) {
        <td>
          <span class="td-content">
            {{
              property[1].isRef
                ? document[property[0]][
                    property[1].isRef.properties.propsList[0]
                  ]
                : document[property[0]]
            }}
          </span>
          <span class="td-popup">{{
            property[1].isRef
              ? document[property[0]][property[1].isRef.properties.propsList[0]]
              : document[property[0]]
          }}</span>
        </td>
        }
        <td>
          <div class="documents-table-buttons">
            <div class="button button-edit" (click)="togglePopup(true, i)">
              {{
                isPopupEdit && isPopupVisible && popupIndex == i
                  ? "Close"
                  : "Edit"
              }}
            </div>
            <div
              class="button button-delete"
              (click)="deleteField(document._id)"
            >
              Delete
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</main>
