<div class="fields-page">
  <div class="fields-page-container">
    <header class="fields-header page-padding">
      <p>Fields of Education</p>
      <div class="button-add button" (click)="togglePopup(false, -1)">
        {{ isPopupVisible && !isPopupEdit ? "Close" : "Add" }}
      </div>
    </header>

    <main class="fields-main page-padding">
      <div class="settings">
        <p>
          Showing {{ getFields().length }}
          {{ getFields().length == 1 ? "entry" : "entries" }}
        </p>
        <div class="search-setting">
          <form
            class="search-form"
            [formGroup]="searchFieldForm"
            (submit)="
              changePage(
                1,
                searchFieldForm.value.search == '' ? false : true,
                searchFieldForm
              )
            "
          >
            <label for="search"
              >Search by:
              <select name="search-param" formControlName="select">
                <option value="name">name</option>
                <option value="code">code</option>
              </select></label
            >
            <input type="text" formControlName="search" id="search" />
          </form>
        </div>
      </div>
      <table class="fields-table">
        <thead>
          <th>Subject Code</th>
          <th>Subject Name</th>
          <th>Controls</th>
        </thead>
        <tbody class="table-body">
          <tr
            class="table-row"
            *ngFor="let field of getFields(); let i = index"
          >
            <td class="code-value">{{ field.code }}</td>
            <td class="name-td">{{ field.name }}</td>
            <td class="buttons-td">
              <div class="buttons">
                <div class="button-edit button" (click)="togglePopup(true, i)">
                  {{
                    isPopupEdit && isPopupVisible && popupIndex == i
                      ? "Close"
                      : "Edit"
                  }}
                </div>
                <div class="button-delete button" (click)="onDelete(field._id)">
                  Delete
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </main>

    <footer class="fields-pagination-footer page-padding">
      <div class="select-page">
        <div
          class="page-button-left pagination-styles {{
            getPage() == 1
              ? 'pagination-styles-disabled'
              : 'pagination-styles-enabled-hover'
          }}"
          (click)="
            changePage(getPage() - 1, getIsSearchActive(), searchFieldForm)
          "
        >
          &lt; Previous
        </div>
        <div class="numbered-pages">
          <div
            class="page-option pagination-styles  {{
              getPage() ==
              getPage() - (getPage() - 1 < 5 ? getPage() - 1 : 4) + i
                ? 'page-selected'
                : 'pagination-styles-enabled-hover'
            }}"
            *ngFor="
              let num of [].constructor(getPageCountToIterate());
              let i = index
            "
            (click)="
              changePage(
                getPage() - (getPage() - 1 < 5 ? getPage() - 1 : 4) + i,
                getIsSearchActive(),
                searchFieldForm
              )
            "
          >
            {{ getPage() - (getPage() - 1 < 5 ? getPage() - 1 : 4) + i }}
          </div>
        </div>

        <div
          class="page-button-right pagination-styles {{
            getPage() == getPageCount()
              ? 'pagination-styles-disabled'
              : 'pagination-styles-enabled-hover'
          }}"
          (click)="
            changePage(getPage() + 1, getIsSearchActive(), searchFieldForm)
          "
        >
          Next &gt;
        </div>
      </div>
    </footer>

    <div class="field-popup" *ngIf="isPopupVisible">
      <h2 class="popup-heading">
        {{ isPopupEdit ? "Edit field" : "Add field" }}
      </h2>
      <p class="error-message" *ngIf="popupError">{{ popupError }}</p>
      <form
        class="field-form"
        [formGroup]="popupFieldForm"
        (submit)="popupFormAction()"
      >
        <div class="input-container">
          <label for="code">Code</label>
          <input type="text" formControlName="code" id="code" />
          <p
            class="error-message"
            *ngIf="
              !popupFieldForm.controls.code.valid &&
              popupFieldForm.controls.code.touched
            "
          >
            Field code must be 3 characters
          </p>
        </div>
        <div class="input-container">
          <label for="name">Name</label>
          <input
            type="text"
            formControlName="name"
            id="name"
            value="{{
              isPopupVisible && isPopupEdit ? getFields()[popupIndex].name : ''
            }}"
          />
          <p
            class="error-message"
            *ngIf="
              !popupFieldForm.controls.name.valid &&
              popupFieldForm.controls.name.touched
            "
          >
            Name must be at least 5 characters
          </p>
        </div>

        <button
          type="submit"
          class="field-popup-button"
          [disabled]="!popupFieldForm.valid"
        >
          {{ isPopupEdit ? "Edit" : "Add" }}
        </button>
      </form>
    </div>
  </div>
</div>
